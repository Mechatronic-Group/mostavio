---
import Container from "./molecules/Container.astro";
import { getCollection } from "astro:content";
import Button from "./atoms/Button.astro";
import Headline from "./atoms/Headline.astro";

const posts = await getCollection("posts");
const sortedPosts = posts.sort((a, b) => {
    const dateA = new Date(a.data.date);
    const dateB = new Date(b.data.date);
    return dateB.getTime() - dateA.getTime(); // newest first
});

const latestThree = sortedPosts.slice(0, 3);
---

<section>
    <Container>
        <div
            class="flex flex-col items-center mb-20 text-center space-y-6 md:flex-row md:justify-between md:items-center md:space-y-0"
        >
            <Headline
                className="text-6xl md:text-9xl uppercase order-1 md:order-2 text-[#1c1c1c]"
                gradient={false}>News</Headline
            >
            <Button
                variant="dark"
                link="/news"
                containerClass="uppercase order-2 md:order-1"
                ctaLabel="All News"
            />
        </div>
        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {
                latestThree.map((post) => (
                    <div
                        id={post.slug}
                        data-featured={post.data.featured}
                        data-post={post.data.intro}
                        class="group my-6 md:my-8"
                    >
                        <div class="mt-6 relative">
                            <a href={`/news/${post.slug}`} class="">
                                <h3 class="text-2xl text-gray-800 dark:text-white md:min-h-40">
                                    {post?.data.header}
                                </h3>
                            </a>
                            {post?.data?.date && (
                                <p class="mt-6 mb-8 text-[#FF8914]">
                                    {post?.data?.date}
                                </p>
                            )}
                            <div class="border-b border-gray-300 w-1/3 " />
                            {post?.data?.intro && (
                                <p class="mt-6 mb-8 dark:text-gray-400 md:min-h-60">
                                    {post?.data?.intro}
                                </p>
                            )}
                            <a
                                class="inline-block mt-3"
                                href={`/news/${post.slug}`}
                            >
                                <span class="text-[#FF8914] uppercase">
                                    Read
                                </span>
                            </a>
                        </div>
                    </div>
                ))
            }
        </div>
    </Container>
</section>
