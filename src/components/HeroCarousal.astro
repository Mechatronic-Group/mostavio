---
import Video1 from "../assets/videos/Cybertruck-Built-For-Any-Planet-Desktop.webm";
import Video2 from "../assets/videos/Cybertruck-Beyond-Prepared-Desktop.mp4";
import Video3 from "../assets/videos/Cybertruck-Dopamine-On-Tap-Desktop.mp4";
import Video4 from "../assets/videos/Cybertruck-Keep-the-Adventure-Going-Desktop.mp4";
import { externalLinks } from "consts";

let videos: Array<string> = [Video1, Video2, Video3, Video4];
let activeVideo: number = 0;
---

<section
    class="relative overflow-hidden scroll-mt-24 bg-gradient-default"
    id="home"
>
    <video
        id="carouselVideo"
        class="w-full h-screen object-cover transition-opacity duration-500 opacity-100"
        autoplay
        muted
        playsinline
        src={videos[activeVideo]}
        data-videos={JSON.stringify(videos)}
        transition:persist
    >
    </video>
    <div class="absolute inset-0 top-1/4 text-center mx-auto">
        <h2
            class="m-4 md:m-8 text-gray-900 dark:text-white font-bold text-4xl sm:text-5xl md:text-6xl"
        >
            Experience the Future of Flight
        </h2>
        <span class="text-gray-900 dark:text-white m-4 py-4"
            >Transforming Urban Air Mobility with Next-Generation eVTOL
            Technology</span
        >
    </div>
    <div
        class="absolute bottom-24 left-1/2 transform -translate-x-1/2 space-x-2 z-10"
    >
        {
            videos.map((_, index) => (
                <button
                    class={`swiper-pagination-bullet inline-block h-2 w-2 rounded-full bg-white ${index === activeVideo ? "swiper-pagination-bullet-active" : ""}`}
                    data-index={index}
                />
            ))
        }
    </div>
    <div
        class="absolute bottom-8 md:bottom-24 right-8 md:right-20 text-gray-950 dark:text-white flex gap-4 z-10"
    >
        {
            externalLinks.map((item, index) => (
                <button class="relative align-middle select-none" type="button">
                    <item.icon />
                </button>
            ))
        }
    </div>
    <script>
        const videoElement: HTMLVideoElement = document.getElementById(
            "carouselVideo",
        ) as HTMLVideoElement;
        const dots = document.querySelectorAll(".swiper-pagination-bullet");
        const videos = JSON.parse(videoElement.getAttribute("data-videos"));
        let activeVideo = 0;

        function updateVideo() {
            videoElement.classList.add("blur");
            setTimeout(() => {
                videoElement.src = videos[activeVideo];
                videoElement.load();
                dots.forEach((dot, index) => {
                    dot.classList.toggle(
                        "swiper-pagination-bullet-active",
                        activeVideo === index,
                    );
                });
            }, 250);
            videoElement.classList.remove("blur");
        }

        dots.forEach((dot, index) => {
            dot.addEventListener("click", () => {
                activeVideo = Number(dot.getAttribute("data-index"));
                updateVideo();
            });
        });
        videoElement.addEventListener("ended", () => {
            activeVideo = (activeVideo + 1) % videos.length;
            updateVideo();
        });
    </script>
</section>

<style is:global>
    .blur {
        filter: blur(5px);
    }
    section.bg-gradient-default {
        position: relative;
    }
    section.bg-gradient-default::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 20%;
        background: linear-gradient(to bottom, rgb(12 11 10), rgba(0, 0, 0, 0));
    }
    section.bg-gradient-default::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 25%;
        background: linear-gradient(to top, rgb(12 11 10), rgba(0, 0, 0, 0));
    }
</style>
